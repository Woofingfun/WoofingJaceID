<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WoofingJace ID - Mint Your NFT</title>
    <link rel="shortcut icon" href="https://woofingjace.com/images/jace.png" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css2?family=VT323&display=swap' rel='stylesheet'>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding-bottom: 60px;
            font-family: 'VT323', monospace;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #00ffcc;
            text-align: center;
            overflow-x: hidden;
        }
        h2 {
            font-size: 2.5em;
            text-shadow: 0 0 10px #00ffcc, 0 0 20px #ff007f;
            margin: 20px;
        }
        .container {
            width: 600px;
            max-width: 90%;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ffcc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 0 15px #00ffcc;
        }
        .wallet-info {
            font-size: 1.2em;
            text-shadow: 0 0 5px #00ffcc;
            margin: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ff007f;
            border-radius: 10px;
        }
        .input-box {
            margin: 15px 0;
        }
        .input-box label {
            display: block;
            font-size: 1.2em;
            text-shadow: 0 0 5px #00ffcc;
            margin-bottom: 5px;
        }
        input {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff007f;
            border-radius: 5px;
            color: #00ffcc;
            font-family: 'VT323', monospace;
            font-size: 1em;
            text-shadow: 0 0 3px #00ffcc;
        }
        .action-button {
            padding: 10px 20px;
            font-size: 1.2em;
            background: #ff007f;
            color: #00ffcc;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            box-shadow: 0 0 10px #ff007f;
            transition: all 0.3s ease;
            width: 100%;
            margin: 10px 0;
        }
        .action-button:disabled {
            background: #4a4f7a;
            cursor: not-allowed;
            box-shadow: none;
        }
        .action-button:hover:not(:disabled) {
            background: #00ffcc;
            color: #ff007f;
            box-shadow: 0 0 15px #00ffcc;
        }
        .nft-info, .owned-nfts {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border: 1px solid #ff007f;
            border-radius: 10px;
            margin: 10px 0;
        }
        .nft-info p, .owned-nfts p {
            font-size: 1em;
            text-shadow: 0 0 3px #00ffcc;
            margin: 5px 0;
        }
        .owned-nfts ul {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
            padding: 0;
        }
        .owned-nfts li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #ff007f;
        }
        .view-button {
            padding: 5px 10px;
            background: #ff007f;
            color: #00ffcc;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 0.9em;
            box-shadow: 0 0 5px #ff007f;
        }
        .view-button:hover {
            background: #00ffcc;
            color: #ff007f;
            box-shadow: 0 0 10px #00ffcc;
        }
        .nft-preview {
            margin: 10px 0;
        }
        .nft-preview img {
            max-width: 100%;
            border: 1px solid #00ffcc;
            border-radius: 10px;
            box-shadow: 0 0 10px #00ffcc;
        }
        .dog-message {
            font-size: 1em;
            color: #ff007f;
            text-shadow: 0 0 5px #ff007f;
            margin: 10px 0;
            font-style: italic;
        }
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ffcc;
            font-size: 1em;
            text-shadow: 0 0 5px #00ffcc;
            z-index: 1000;
        }
        footer a {
            color: #ff007f;
            text-decoration: none;
        }
        footer a:hover {
            text-decoration: underline;
        }
        @media (max-width: 620px) {
            .container {
                width: 90%;
                padding: 15px;
            }
            h2 {
                font-size: 1.8em;
                margin: 15px;
            }
            .wallet-info {
                font-size: 1em;
                padding: 8px;
            }
            .action-button {
                padding: 8px 16px;
                font-size: 1em;
            }
            .nft-info p, .owned-nfts p {
                font-size: 0.9em;
            }
            .view-button {
                font-size: 0.8em;
                padding: 4px 8px;
            }
            footer {
                font-size: 0.9em;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <h2>WoofingJace ID - Mint Your NFT</h2>
    <div class="wallet-info" id="walletInfo">Detecting wallet...</div>
    <div class="container">
        <div class="input-box">
            <button class="action-button" id="connectWalletButton">Connect Wallet</button>
            <div class="dog-message" id="dogMessage">Woof! Connect your wallet to mint NFTs!</div>
        </div>
        <div class="input-box">
            <label for="nftId">NFT ID (e.g., jace123)</label>
            <input type="text" id="nftId" placeholder="e.g., jace123">
        </div>
        <button class="action-button" id="mintButton" onclick="mintNFT()">Mint NFT</button>
        <div class="nft-info" id="nftInfo">
            <p>Contract: <span id="nftInfoAddress">0xFC8E612a097E091CA8fbD5327ABf63E4E50C8005</span></p>
            <p>Name: <span id="nftInfoName"></span></p>
            <p>Symbol: <span id="nftInfoSymbol"></span></p>
            <p>Suffix: <span id="nftInfoSuffix"></span></p>
            <p>Total Minted: <span id="nftInfoTotalSupply"></span></p>
        </div>
        <div class="owned-nfts">
            <p>Owned NFTs</p>
            <ul id="ownedNFTsList"></ul>
        </div>
        <div class="nft-preview" id="nftPreview" style="display: none;">
            <p>NFT Preview</p>
            <img id="nftImage" src="" alt="NFT Preview">
        </div>
    </div>
    <footer>
        Official Website: <a href="https://woofingjace.com/" target="_blank">woofingjace.com</a>
    </footer>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <script>
        const contractAddress = '0xFC8E612a097E091CA8fbD5327ABf63E4E50C8005';
        const abi = [
            {"inputs":[{"internalType":"string","name":"_id","type":"string"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"minter","type":"address"},{"indexed":false,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"string","name":"id","type":"string"}],"name":"Minted","type":"event"},
            {"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"SUFFIX","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"idsMintedLower","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"ownerToTokenId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
        ];
        const chainConfig = {
            chainId: '0x38',
            chainName: 'BNB Chain',
            rpcUrls: ['https://bsc-dataseed.binance.org/'],
            blockExplorerUrls: ['https://bscscan.com'],
            nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 }
        };
        let provider, signer, contract;

        async function connectWallet() {
            try {
                if (!window.ethereum) throw new Error('No wallet detected. Please install MetaMask or another compatible wallet.');
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send('eth_requestAccounts', []);
                signer = provider.getSigner();
                contract = new ethers.Contract(contractAddress, abi, signer);
                const network = await provider.getNetwork();
                if (network.chainId !== 56) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: chainConfig.chainId }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [chainConfig]
                            });
                        } else {
                            throw new Error('Failed to switch to BNB Chain.');
                        }
                    }
                }
                const account = await signer.getAddress();
                document.getElementById('connectWalletButton').innerText = `Connected: ${account.slice(0, 6)}...${account.slice(-4)}`;
                document.getElementById('walletInfo').innerText = 'Connected to BNB Chain';
                document.getElementById('dogMessage').innerText = 'Woof! Wallet connected, ready to mint!';
                await updateNFTInfo();
                await updateOwnedNFTs();
            } catch (error) {
                document.getElementById('walletInfo').innerText = 'Failed to connect wallet.';
                document.getElementById('dogMessage').innerText = 'Woof! Failed to connect wallet: ' + error.message;
            }
        }

        async function updateNFTInfo() {
            try {
                const [name, symbol, suffix, totalSupply] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.SUFFIX(),
                    contract.totalSupply()
                ]);
                document.getElementById('nftInfoName').innerText = name;
                document.getElementById('nftInfoSymbol').innerText = symbol;
                document.getElementById('nftInfoSuffix').innerText = suffix.toLowerCase();
                document.getElementById('nftInfoTotalSupply').innerText = totalSupply.toString();
            } catch (error) {
                document.getElementById('dogMessage').innerText = 'Woof! Failed to load contract info: ' + error.message;
            }
        }

        async function updateOwnedNFTs() {
            try {
                const account = await signer.getAddress();
                const balance = await contract.balanceOf(account);
                const list = document.getElementById('ownedNFTsList');
                list.innerHTML = '';
                if (balance == 0) {
                    list.innerHTML = '<li>No NFTs owned yet.</li>';
                    return;
                }
                const tokenId = await contract.tokenOfOwnerByIndex(account, 0);
                const tokenName = await contract.tokenName(tokenId);
                const li = document.createElement('li');
                li.innerText = `NFT: ${tokenName} (ID: ${tokenId})`;
                const viewButton = document.createElement('button');
                viewButton.className = 'view-button';
                viewButton.innerText = 'View';
                viewButton.onclick = async () => {
                    const tokenURI = await contract.tokenURI(tokenId);
                    const json = JSON.parse(atob(tokenURI.split(',')[1]));
                    document.getElementById('nftImage').src = json.image;
                    document.getElementById('nftPreview').style.display = 'block';
                };
                li.appendChild(viewButton);
                list.appendChild(li);
            } catch (error) {
                document.getElementById('ownedNFTsList').innerHTML = '<li>Error loading NFTs.</li>';
                document.getElementById('dogMessage').innerText = 'Woof! Failed to load NFTs: ' + error.message;
            }
        }

        async function mintNFT() {
            const nftId = document.getElementById('nftId').value.trim();
            const mintButton = document.getElementById('mintButton');
            const walletInfo = document.getElementById('walletInfo');
            const dogMessage = document.getElementById('dogMessage');

            if (!contract || !signer) {
                walletInfo.innerText = 'Please connect wallet first.';
                dogMessage.innerText = 'Woof! Connect your wallet to mint NFTs!';
                return;
            }

            if (!nftId || nftId.length > 15 || !/^[a-zA-Z0-9]+$/.test(nftId)) {
                walletInfo.innerText = 'Invalid NFT ID. Use 1-15 alphanumeric characters.';
                dogMessage.innerText = 'Woof! ID must be 1-15 letters or numbers!';
                return;
            }

            try {
                mintButton.disabled = true;
                mintButton.innerText = 'Checking...';
                dogMessage.innerText = 'Woof! Checking NFT ID...';

                const account = await signer.getAddress();
                const tokenId = await contract.ownerToTokenId(account);
                if (tokenId != 0) {
                    walletInfo.innerText = 'Address already minted an NFT.';
                    dogMessage.innerText = 'Woof! You already have an NFT!';
                    mintButton.innerText = 'Mint NFT';
                    mintButton.disabled = false;
                    return;
                }

                const nftIdLower = nftId.toLowerCase();
                const isMinted = await contract.idsMintedLower(nftIdLower);
                if (isMinted) {
                    walletInfo.innerText = 'NFT ID already minted.';
                    dogMessage.innerText = 'Woof! This NFT ID is taken!';
                    mintButton.innerText = 'Mint NFT';
                    mintButton.disabled = false;
                    return;
                }

                mintButton.innerText = 'Minting...';
                dogMessage.innerText = 'Woof! Minting your NFT...';
                const gasLimit = await contract.estimateGas.mint(nftId).catch(() => ethers.BigNumber.from('600000'));
                const gasPrice = await provider.getGasPrice();
                const tx = await contract.mint(nftId, {
                    gasLimit: gasLimit.mul(12).div(10),
                    gasPrice
                });
                walletInfo.innerText = 'Transaction sent: ' + tx.hash;
                dogMessage.innerText = 'Woof! Transaction sent, waiting for confirmation...';
                await tx.wait();
                walletInfo.innerText = 'NFT minted successfully!';
                dogMessage.innerText = 'Woof! NFT minted! Check your wallet!';
                await updateNFTInfo();
                await updateOwnedNFTs();
            } catch (error) {
                walletInfo.innerText = error.reason || error.message || 'Minting failed.';
                dogMessage.innerText = 'Woof! Minting failed: ' + (error.reason || error.message);
            } finally {
                mintButton.innerText = 'Mint NFT';
                mintButton.disabled = false;
            }
        }

        document.getElementById('connectWalletButton').addEventListener('click', connectWallet);
    </script>
</body>
</html>
